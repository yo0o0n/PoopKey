# A104 í¬íŒ…ë§¤ë‰´ì–¼

ìƒíƒœ: ì§„í–‰ ì¤‘
ë‹´ë‹¹ì: ìµœì°½í™˜
ë‚ ì§œ: 2024ë…„ 1ì›” 23ì¼
ì„ íƒ: ğŸ“£ ë°œí‘œ

# ëª©ì°¨

1. í”„ë¡œì íŠ¸ ê¸°ìˆ ìŠ¤íƒ
2. EC2 ì„œë²„ ì„¸íŒ…ê³¼ ë¹Œë“œ ìƒì„¸ ë‚´ìš©
3. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì •ë³´
4. DB ë¤í”„ íŒŒì¼ ìµœì‹ ë³¸
5. ì‹œì—° ì‹œë‚˜ë¦¬ì˜¤

---

# 1. í”„ë¡œì íŠ¸ ê¸°ìˆ ìŠ¤íƒ

### ê°œë°œí™˜ê²½

- ì´ìŠˆ ê´€ë¦¬ : Jira
- í˜•ìƒ ê´€ë¦¬ : Git, Gitlab
- ì˜ì‚¬ì†Œí†µ, í˜‘ì—… : Notion, Mattermost, (Gerrit)
- ê°œë°œ í™˜ê²½
    - OS : Window10
    - IDE :
        - Intellij(BE) : 2023.3.2
        - VSCode(FE) : 1.85.1
        - STM32CubeIDE(HW) : 1.14.1
    - EC2 : Ubuntu 20.04.6 LTS (GNU/ë²„ì „ì •ë³´)
    - Database : MySQL 8.0.35
    - SSH : MobaXterm
    - CI/CD : Jenkins
    - Reverse Proxy : Nginx
    - SSL : CertBot, Letâ€™s Encrypt
- Frontend
    - React : 18.2.0
    - Node.js : 20.11.0
    - npm : 10.2.4
    - npx : 10.2.4
- Backend
    - Springboot : 3.2.2
    - JDK : 17 Azul Zulu version 17.0.9
    - Java : 17
    - Spring websocket
    - Spring security
    - lombok
    - MySQL driver
    - MyBatis Framework
    - Springboot Devtools
    - Thymeleaf
    - OAuth2 Client
- Hardware
    - board : STM32F103RB
    - ì„œë³´ëª¨í„° : MG996R, SG90
    - ì´ˆìŒíŒŒì„¼ì„œ : HC-SR04
    - IRì„¼ì„œ : MLX90614
    - ë§ˆê·¸ë„¤í‹±ì„¼ì„œ
    - LED
    - wifi ëª¨ë“ˆ : ESP8266-01
    - ë¼ì¦ˆë² ë¦¬íŒŒì´ v4 B
    - ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼
    - tiltì„¼ì„œ : SW-520D
- AI
    - PyTorch : 2.1.2
    - Python : 3.9.2
    - OpenCV : 4.9.0
    - Yolo : 8

---

# 2. EC2 ì„œë²„ ì„¸íŒ…ê³¼ ë¹Œë“œ ìƒì„¸ ë‚´ìš©

## (0) í¬íŠ¸, ë°©í™”ë²½ ì„¤ì •

í”„ë¡œì íŠ¸ì— ì‚¬ìš©ë˜ëŠ” í¬íŠ¸ë¥¼ ì •ë¦¬í•˜ê³  ë°©í™”ë²½ í¬íŠ¸ í—ˆìš© ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤

| ì´ìš©ëª©ì  | í¬íŠ¸ë²ˆí˜¸ |
| --- | --- |
| Redis | 6379 |
| Netty TCP socket í†µì‹  | 8200 |
| Backend server | 9999 |
| Frontend server | 3000 |
| IMAP | 993 |
| SMTP | 465 |
| FCM XMPP ì—°ê²° | 5228-5230 |

```bash
# ë°±ì—”ë“œ : 9999 [í•„ìš”]
# IMAP(ë©”ì¼ì „ì†¡) : 993 [í•„ìš”]
# SMTP(ë©”ì¼ì „ì†¡) : 465 [í•„ìš”]
# FCM ì¹´ì¹´ì˜¤ í‘¸ì‹œì•Œë¦¼ì—ì„œ XMPP ì—°ê²° : 5228, 5229, 5230 [í•„ìš”]

# ufw êµ¬ë™ëœ ìƒíƒœì—ì„œ ê°œë°©í•´ì•¼ë˜ëŠ” í¬íŠ¸ ì¶”ê°€í•˜ê¸°
sudo ufw allow 9999
sudo ufw allow 993
sudo ufw allow 465
sudo ufw allow 5228
sudo ufw allow 5229
sudo ufw allow 5230

# í¬íŠ¸ ì •ìƒ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸°
sudo ufw status numbered
# allow ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©´ ìë™ìœ¼ë¡œ ufwì— ë°˜ì˜ë˜ì–´ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤. 
```

```bash
#ê¸°íƒ€
# ufw ë„ê¸°
sudo ufw disable
```

**ì£¼ì˜! ufw ì„¤ì •ê³¼ ë³„ê°œë¡œ ë§‰í˜€ìˆëŠ” ì‚¬ë‚´ ë°©í™”ë²½ í¬íŠ¸ í—ˆìš©ì„ ì¶”ê°€ ìš”ì²­í•´ì•¼í•©ë‹ˆë‹¤.**

## (1) Docker ì„¤ì¹˜

- EC2 ì„œë²„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥

```bash
# Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
	"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
$(. /etc/os-release&& echo "$VERSION_CODENAME") stable" | \
sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

# Install the Docker packages.
sudo apt-get install docker-ce docker-ce-cli containered.io docker-buildx-plugin docker-compose-plugin

# Docker Hello Test
sudo docker run hello-world
```

## (2) Jenkins ì¶”ê°€

- ì  í‚¨ìŠ¤ ì„¤ì¹˜, ì„¤ì • ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤

```bash
# 1. docker ë°©ì‹ ì„¤ì¹˜ ì‹œ
#   1) jenkins container ìƒì„± ë° êµ¬ë™
       cd /home/ubuntu && mkdir jenkins-data

       sudo ufw allow *8080*/tcp
       sudo ufw reload
       sudo ufw status

       sudo docker run -d -p 8080:8080 -v /home/ubuntu/jenkins-data:/var/jenkins_home --name jenkins jenkins/jenkins:lts

       sudo docker logs jenkins

       sudo docker stop jenkins
       sudo docker ps -a

#   2) í™˜ê²½ ì„¤ì • ë³€ê²½ (ë§¤ìš° ì¤‘ìš”)
       cd /home/ubuntu/jenkins-data
       
       mkdir update-center-rootCAs

       wget https://cdn.jsdelivr.net/gh/lework/jenkins-update-center/rootCA/update-center.crt -O ./update-center-rootCAs/update-center.crt

       sudo sed -i 's#https://updates.jenkins.io/update-center.json#https://raw.githubusercontent.com/lework/jenkins-update-center/master/updates/tencent/update-center.json#' ./hudson.model.UpdateCenter.xml

       sudo docker restart jenkins
```

## (3) Docker-Network ì¶”ê°€

- DBì»¨í…Œì´ë„ˆì™€ ìŠ¤í”„ë§ë¶€íŠ¸ Backend ì»¨í…Œì´ë„ˆë¥¼ ì—°ê²°í•˜ê¸° ìœ„í•œ ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.

```bash
sudo docker network create [ë„¤íŠ¸ì›Œí¬ëª…]
```

## (4) Nginx ì„¤ì¹˜, ì„¤ì •

- Nginx ì„¤ì¹˜

```bash
#install ì‘ì„±í•˜ê¸°
sudo apt update
sudo apt install nginx
```

- Nginx ì„¤ì •íŒŒì¼ ì‘ì„±

```bash
##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {
	# 80 <-> 9999
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

 	root /var/www/html;
	#root /var/www/html/build;
	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;

	}	
	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
    charset utf-8;
}

# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}

server {

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	# root /var/www/html;
	# root /var/www/html/build;
	# Add index.php to the list if you are using PHP
	# index index.html index.htm index.nginx-debian.html;
	server_name i10a104.p.ssafy.io; # managed by Certbot
	charset utf-8;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
	        proxy_pass http://localhost:3000;
	        proxy_set_header Host $host;
       		proxy_set_header X-Real-IP $remote_addr;
      		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	        proxy_set_header X-Forwarded-Proto $scheme;
	#	try_files $uri $uri/ =404;
	}

        location /swagger-ui {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                proxy_pass http://localhost:9999;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
        #       try_files $uri $uri/ =404;
        }
	

        location /v3 {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                proxy_pass http://localhost:9999;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
        #       try_files $uri $uri/ =404;
        }

        location /api {
								# backend ì„œë²„ ìš”ì²­ api
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                proxy_pass http://localhost:9999;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
	 #      try_files $uri $uri/ =404;
        }

        location /ws {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                proxy_pass http://localhost:9999;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
				# ì›¹ì†Œì¼“ ê´€ë ¨ ì„¤ì • ì¶”ê°€
    		proxy_http_version 1.1;
    		proxy_set_header Upgrade $http_upgrade;
    		proxy_set_header Connection "Upgrade";
        #       try_files $uri $uri/ =404;
	}

	# ë¶„ê¸°ì²˜ë¦¬	
	# location /api {
	# proxy_pass http://i10a104.p.ssafy.io:9999;
	# proxy_set_header Host $host;
	# proxy_set_header X-Real-IP $remote_addr;
	# proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;	
	# }

	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/i10a104.p.ssafy.io/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/i10a104.p.ssafy.io/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    
}
server {
    if ($host = i10a104.p.ssafy.io) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

	# 80<->9999
	listen 80;
	listen [::]:80 ;
    server_name i10a104.p.ssafy.io;
    return 404; # managed by Certbot
}
```

## (5) SSL ì ìš©

- Certbotì„ ì´ìš©í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ ë°±ì—”ë“œ ì„œë²„ì— SSLì„ ì ìš©í•©ë‹ˆë‹¤.

```bash
sudo add-apt-repository ppa:certbot/certbot
sudo apt update
sudo apt install python3-certbot-nginx

# Nginx ì„¤ì • íŒŒì¼ ê²½ë¡œë¡œ ì´ë™
cd /etc/nginx/conf.d

# Certbotì„ ì‚¬ìš©í•˜ì—¬ SSL ì¸ì¦ ë°œê¸‰
sudo certbot --nginx -d i10a104.p.ssafy.io:8080
```

## (6) MySQL ì„¤ì •

- ì»¨í…Œì´ë„ˆ DBë‚´ìš©ì´ ì»¨í…Œì´ë„ˆê°€ ëë‚˜ë„ ê³„ì† ìœ ì§€ë  ìˆ˜ ìˆë„ë¡ ë„ì»¤ volume mount ì„¤ì •ì„ í•©ë‹ˆë‹¤.
1. SQL íŒŒì¼ ìƒì„±
ê¸°ì¡´ì— ìƒì„±í•œ DB ìŠ¤í‚¤ë§ˆ, ë”ë¯¸ë°ì´í„° íŒŒì¼ì„ EC2ì„œë²„ì— ì—…ë¡œë“œ

```bash
# ë„ì»¤ ë³¼ë¥¨ ìƒì„±
sudo docker volume create mysql-data
# MySQL ì»¨í…Œì´ë„ˆ ì‹¤í–‰
sudo docker run -d --name {sql-container-name} -e MYSQL_ROOT_PASSWORD={password} -v mysql-data:/var/lib/mysql mysql:latest
# SQL íŒŒì¼ ë³µì‚¬
sudo docker cp your_sql_file.sql mysql-container:/tmp/your_sql_file.sql
# MySQL ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ SQL ì‹¤í–‰
# (1) ì»¨í…Œì´ë„ˆ ë‚´ë¶€ bashë¡œ ë“¤ì–´ê°
sudo docker exec -it mysql-container bash
# (2) sql ë‚´ìš© ë³µì‚¬
sudo mysql -u root -p < /tmp/your_sql_file.sql
# ì™„ì„±ëœ DB ì»¨í…Œì´ë„ˆë¥¼ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë„ì»¤ ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°ì„¤ì •í•˜ëŠ” ê³¼ì •ì´ í•„ìš”
# DB ì»¨í…Œì´ë„ˆë¥¼ ì •ì§€í•˜ê³ 
docker stop [DB ì»¨í…Œì´ë„ˆëª…]
# Docker Network ì—°ê²°
docker network connect [ë„ì»¤ ë„¤íŠ¸ì›Œí¬ëª…] [DB ì»¨í…Œì´ë„ˆëª…]
```

- DB ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œì„¤ì •ëœ ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤.
ê³„ì •ëª… : root
{DNS}:{port} : ubuntu@i10a104.p.ssafy.io:22
- Dockerfile ì„¤ì •

```bash
FROM mysql:8.0.35
ENV MYSQL_ROOT_PASSWORD=ssafy \
	MYSQL_DATABASE=poopkey \
	MYSQL_USER=ssafy \
	MYSQL_PASSWORD=ssafy
EXPOSE 3306
COPY projectDB.sql /docker-entrypoint-initdb.d/
VOLUME /var/lib/mysql
CMD ["mysqld"]
```

## (7) Backend ì„¤ì •

- ìŠ¤í”„ë§ë¶€íŠ¸ appilcation.propertiesì„¤ì •

```bash
# DB setting
#  spring.datasource.url change! local PC (localhost) -> EC2 (mysql-container)
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://{DB ë„ì»¤ ì»¨í…Œì´ë„ˆì˜ DNSì´ë¦„}:3306/{dbëª…}?serverTimezone=UTC&allowMultiQueries=true
spring.datasource.username=ssafy
spring.datasource.password=ssafy

# mybatis
mybatis.mapper-locations=mappers/**/*.xml
mybatis.type-aliases-package=com.project.poopkey.application.main.dto, com.project.poopkey.application.render.dto, com.project.poopkey.application.main.security.dto
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.force=true

# for netty communication and DB transaction
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.maximum-pool-size=10

# DB column snake_case -> DTO camelCase
mybatis.configuration.map-underscore-to-camel-case=true

logging.level.root=DEBUG

# netty server
netty.server.port = 8200

jwt.secret.key=f2c0d20c7b9f5117c70bf12421b4d3e191acc914bafa43592963e4c08d7b297f

# mail send
spring.mail.host=smtp.address
spring.mail.port={í¬íŠ¸ë²ˆí˜¸}
spring.mail.username={smtp ì„œë²„ ì‚¬ìš©ìì˜ id}
spring.mail.password={smtp ì„œë²„ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.ssl.enable=true

# backend port 8080->9999
server.port=9999
```

- Dockerfile ì„¤ì •

```bash
FROM openjdk:17
ARG JAR_FILE=*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

- Springboot Docker image ìƒì„±

```bash
sudo docker build -t [ì´ë¯¸ì§€ëª…] [ì´ë¯¸ì§€ ì„¤ì • ì •ë³´ê°€ ë‹´ê²¨ìˆëŠ” ê²½ë¡œex) /home/ubuntu/backend_test/spring-websocket-test/]
```

- DNS ì´ë¦„ ë³€ê²½ ì„¤ì •

springboot application.propertiesì—ì„œ ì„¤ì •í•œ DB ë„ë©”ì¸ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” ê°™ì€ DNS ì´ë¦„ìœ¼ë¡œ ì—°ê²°ì‹œì¼œì¤˜ì•¼ í•œë‹¤.

```bash
# í˜„ì¬ ë„ì»¤ ì»¨í…Œì´ë„ˆ DNSì´ë¦„ì„ í™•ì¸í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´
sudo docker inspect [ì»¨í…Œì´ë„ˆ id]
# ìŠ¤í”„ë§ application.propertiesì—ì„œ ì„¤ì •í•œ DNSì™€ ë§ê²Œ ë°”ê¿”ì¤€ë‹¤.
docker rename [ì›ë˜ ì»¨í…Œì´ë„ˆëª…] [ë°”ê¿”ì•¼ë˜ëŠ” DNS]
```

## (8) Frontend ì„¤ì •

- Dockerfile ì„¤ì •

```bash
FROM nginx:stable-alpine
COPY . /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 3000
CMD ["nginx", "-g", "daemon off;"]
```

- React Docker image ìƒì„±

```bash
sudo docker build -t [ì´ë¯¸ì§€ëª…]
```

- nginx.conf íŒŒì¼ ì‘ì„±

```bash
server {
	listen 3000;
	location / {
		root /usr/share/nginx/html;
		index index.html;
		try_files $uri $uri/ /index.html;
	}
}
```

## (9) Build ì„¤ì •

```bash
# MySQL ì»¨í…Œì´ë„ˆ ë¹Œë“œ
sudo docker run --name [ì»¨í…Œì´ë„ˆëª…] -p 3306:3306 --network [ë„ì»¤ ë„¤íŠ¸ì›Œí¬ëª…] -e MYSQL_ROOT_PASSWORD=[MySQL Rootì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸] -e MYSQL_DATABASE=[dbëª…] -e MYSQL_USER=[DBì‚¬ìš©ìëª…] -e MYSQL_PASSWORD=[Userë¹„ë°€ë²ˆí˜¸] -d mysql:8.0.35
# ìŠ¤í”„ë§ë¶€íŠ¸ ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ë¹Œë“œ
sudo docker run -p 8200:8200 -p 9999:9999 --name [ì»¨í…Œì´ë„ˆëª…] --network [ë„¤íŠ¸ì›Œí¬ëª…] -d [ë„ì»¤ì´ë¯¸ì§€]
# ë¦¬ì•¡íŠ¸ í”„ë¡ íŠ¸ì—”íŠ¸ ì»¨í…Œì´ë„ˆ ë¹Œë“œ
sudo docker run -d -p 127.0.0.1:3000:3000 [ì»¨í…Œì´ë„ˆëª…]
```

---

# 3. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì •ë³´

ì›ë˜ ê³„íšìƒ ì‚¬ìš©í•˜ë ¤ê³  í–ˆë˜ ì™¸ë¶€ APIì— ëŒ€í•œ ì •ë³´ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- ì¹´ì¹´ì˜¤ RESTAPI pushì•Œë¦¼

[https://developers.kakao.com/docs/latest/ko/push/rest-api](https://developers.kakao.com/docs/latest/ko/push/rest-api)

---

# 4. DB ë¤í”„ íŒŒì¼ ìµœì‹ ë³¸

gitlab í”„ë¡œì íŠ¸ exec/DBdump ë””ë ‰í† ë¦¬ì— ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤.

---

# 5. ì‹œì—° ì‹œë‚˜ë¦¬ì˜¤

## (1) ì‚¬ìš©ì
1. íƒ€ì´í‹€ í™”ë©´ì—ì„œ ê±´ë¬¼ ì´ë¦„ì„ í´ë¦­í•˜ê³  í™”ì¥ì‹¤ í˜„í™©ì´ ë³´ì´ëŠ” í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ìš°ì¸¡ ìŠ¤í¬ë¡¤ì„ ì›€ì§ì—¬ì„œ ì°¾ì•„ë³´ê³ ì‹¶ì€ í™”ì¥ì‹¤ ì¸µìˆ˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
3. í™”ì¥ì‹¤ í™”ë©´ì—ì„œ ê° ì¹¸ì— ëŒ€í•œ ì •ë³´(ì‚¬ìš©ê°€ëŠ¥, ì‚¬ìš©ì¤‘, ê³ ì¥, ì ê²€ì¤‘)ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
4. ìš°ì¸¡ ë¦¬ìŠ¤íŠ¸ì—ì„œ í™”ì¥ì‹¤ í˜¼ì¡ë„ ì •ë³´(ì›í™œ, í˜¼ì¡, í¬í™”, ì—†ìŒ)ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
5. ì‹ ê³ ë¥¼ ë³´ë‚´ê³  ì‹¶ì€ í™”ì¥ì‹¤ ì¹¸ì„ í´ë¦­í•´ì„œ ì‹ ê³  í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
6. ì‹ ê³ í™”ë©´ì—ì„œ ì‹ ê³ ì‚¬ìœ (ìœ„ìƒ, íŒŒì†, ê¸°íƒ€)ë¥¼ ì„ íƒí•˜ê³  í•„ìš”ì‹œ ì‹ ê³ ë‚´ìš©ì„ ì‘ì„±í•´ì„œ ì œì¶œí•©ë‹ˆë‹¤.
## (2) ê´€ë¦¬ì
1. mainí™”ë©´ì—ì„œ í™”ì¥ì‹¤ í˜„í™© ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì‚¬ìš©ì í˜ì´ì§€ì˜ í™”ì¥ì‹¤ í˜„í™©ê³¼ ê°™ì€ ë ˆì´ì•„ì›ƒ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™”ì¥ì‹¤ ì¹¸ì„ í´ë¦­í•˜ë©´ ìƒíƒœ ë³€ê²½ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
3. ë³€ê²½í•˜ê³  ì‹¶ì€ ìƒíƒœ(ì‚¬ìš©ê°€ëŠ¥, ê³ ì¥, ì ê²€ì¤‘)ë¥¼ í´ë¦­í•˜ê³  í™•ì¸ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê·¸ ì¹¸ì˜ ìƒíƒœê°€ ë³€ê²½ë©ë‹ˆë‹¤.
4. mainí™”ë©´ì—ì„œ í™”ì¥ì‹¤ ë“±ë¡ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í™”ì¥ì‹¤ ë“±ë¡í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
5. í™”ì¥ì‹¤ì˜ ê°€ë¡œì„¸ë¡œ ê²©ì ê°œìˆ˜ì™€ ì„±ë³„ ì¸µìˆ˜ë¥¼ ì…ë ¥í•˜ê³  ê° ì¹¸ì— ëŒ€í•œ ì •ë³´(í™”ì¥ì‹¤ -> ì…êµ¬ -> ë¹ˆì¹¸ -> í™”ì¥ì‹¤)ë¥¼ í´ë¦­ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì œì¶œí•˜ë©´ ìƒˆë¡œìš´ í™”ì¥ì‹¤ ì •ë³´ê°€ ë“±ë¡ë©ë‹ˆë‹¤.
6. í™”ì¥ì‹¤ ì•Œë¦¼ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê´€ë¦¬ìì—ê²Œ ë“¤ì–´ì˜¨ ì‹ ê³  ë‚´ìš©ì´ ìš°ì¸¡ ë¦¬ìŠ¤íŠ¸ì— í‘œì‹œë©ë‹ˆë‹¤.
7. íŠ¹ì • ì‹ ê³  ë‚´ìš©ì„ í´ë¦­í•˜ë©´ ì‹ ê³ ê°€ ì ‘ìˆ˜ëœ í™”ì¥ì‹¤ì¹¸ì˜ ì¸µìˆ˜, ì„±ë³„, ë²ˆí˜¸ ì •ë³´ê°€ í‘œì‹œë˜ê³  í´ë¦­í•˜ë©´ ê·¸ í™”ì¥ì‹¤ ì¹¸ì´ ì¡´ì¬í•˜ëŠ” í™”ì¥ì‹¤ í˜„í™© í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
8. mainí™”ë©´ì—ì„œ í™”ì¥ì‹¤ í†µê³„ ë²„íŠ¼ì„ í´ë¦­í•˜ê³  ì¸µìˆ˜ì™€ ì„±ë³„ì„ ì„ íƒí•´ì„œ ì œì¶œí–ˆì„ ë•Œ ê·¸ í™”ì¥ì‹¤ì— ëŒ€í•œ ì´ìš© í†µê³„ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
---

## ê¸°íƒ€

- Docker Root Dir: /var/lib/docker
- ì»¨í…Œì´ë„ˆ bashì—ì„œ DB ì •ë³´ í™•ì¸í•˜ê¸°

```bash
sudo docker exec -it [DBì»¨í…Œì´ë„ˆ id] bash
# ì•„ë˜ ê²½ë¡œì— DB ì¡´ì¬
# /var/lib/mysql
sudo docker exec -it mysql-container mysql -u root -p
# ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
[ë¹„ë°€ë²ˆí˜¸]
USE [Database ì´ë¦„];
# ì´í›„ sql ì¿¼ë¦¬ ì…ë ¥
```
